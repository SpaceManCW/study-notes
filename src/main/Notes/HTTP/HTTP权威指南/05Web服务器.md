### Web 服务器与代理 p116-p168

Web服务器可以表示Web服务器的软件，也可以用来表示提供Web页面的特定设备或计算机。所有的Web服务器都能接受HTTP请求并响应。Web服务器逻辑上实现HTTP和相关TCP连接处理。负责管理资源，以及对Web服务器的配置、控制、扩展方面的管理。

#### 实际的Web服务器会做些什么

- 接受客户端连接，服务器从TCP连接中将IP地址解析出来，将连接添加到现存的Web服务器连接列表。Web服务器可以随意拒绝或关闭任意连接。
- 接受请求报文，解析请求报文，解析请求行，查找请求方法、指定URI、版本号；读取报文首部，以CRLF结尾；读取请求主体。Web服务器需要不断接受读取数据，将部分报文数据临时存储在内存，直到接收到足以进行解析的数据并理解其意义为止。
- 处理请求，根据方法、资源、首部和可选主体部分对请求进行处理
- 对资源的映射及访问，将请求报文中的URI映射为Web服务器上适当的内容或内容生成器。
- 构建响应，执行请求方法中描述的动作并返回响应报文
- 发送响应
- 记录日志，事务结束，Web服务器在日志文件中添加一个条目用来描述已执行的事务

#### 代理

代理位于客户端和服务器之间，在各端点之间来回传送HTTP报文。客户端与代理对话，由代理代表客户端与服务器交流。代理既是服务器又是客户端，代理要接受客户端请求并响应，也要发送请求给服务器。代理分为私有和公有，专门给一个客户端用的代理叫私有代理，几个客户端公用的代理叫公共代理。

> 代理和网关的对比：代理连接的是两个或多个协议相同的应用程序；网关连接的是两个或多个使用不同协议的端点。网关扮演的是‘协议转换器’的角色，既是客户端和服务器使用不同协议也可通过网关实现事务处理。但是代理有时候也要做一些协议转换的工作。

那么为什么要使用代理？可以改善安全性，提高性能，节约费用。代理可以看到并接触所有流过HTTP的流量，所以可以监视和修改流量。比如，

- 可利用过滤代理阻止学生访问成人内容
- 在服务器和资源之间实现统一的访问控制，创建审核跟踪机制
- 安全防火墙，对流量进行检查，提供消除病毒的代理
- Web缓存，代理缓存维护了常用文档的本地副本，按需提供减少通信
- 反向代理，反向代理可假扮服务器，接受发送给服务器的请求，并发起与其他服务器的通信
- 匿名代理，主动从HTTP报文中删除身份特征，比如User-Agent、From、Referer等

关于代理的内容书中有很多，当下就先不做详细了解了。。。
