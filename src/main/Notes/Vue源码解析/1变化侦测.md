## 变化侦测

变化侦测就是追踪状态，因为状态一旦发生变化就要去更新视图

> **如何观测数据变化？**
>
> 利用 `Object.defineProperty`方法

观测到状态变化后就要进行视图更新，更新谁，不能将所有视图都更新，谁用到这个状态就更新谁。将每个数据创建一个依赖数组，数据更新就将依赖数组中的所有依赖更新一遍

> **何时收集依赖？何时进行依赖更新？**
>
> 可观测的数据被获取时会触发 `getter`属性，那么我们就可以在 `getter`中收集这个依赖。同样，当这个数据变化时会触发 `setter`属性，那么我们就可以在 `setter`中通知依赖更新。
>
> **依赖收集到哪里？**
>
> 数组的结构功能不全，定义一个依赖管理类 `Dep`，包含依赖数组以及收集、删除、通知更新的方法，在getter和setter方法中调用收集和更新的方法即可
>
> **依赖是什么？**
>
> 利用 `Watcher`类，谁用到了数据，谁就是依赖，我们就为谁创建一个 `Watcher`实例，数据变化时，我们不直接去通知依赖更新，而是通知依赖对应的 `Watch`实例，由 `Watcher`实例去通知真正的视图， `Watcher`类实现了更新视图的方法

总结：

1. `Data`通过 `observer`转换成了 `getter/setter`的形式来追踪变化。
2. 当外界通过 `Watcher`读取数据时，会触发 `getter`从而将 `Watcher`添加到依赖中。
3. 当数据发生了变化时，会触发 `setter`，从而向 `Dep`中的依赖（即Watcher）发送通知。
4. `Watcher`接收到通知后，会向外界发送通知，变化通知到外界后可能会触发视图更新，也有可能触发用户的某个回调函数等。
